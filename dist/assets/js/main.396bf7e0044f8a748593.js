(()=>{var e={302:(e,t,o)=>{"use strict";e.exports=o.p+"b88d04fba731603756b1.css"},543:(e,t,o)=>{class n extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this._stream=null;const e=document.createElement("link");e.rel="stylesheet",e.href=new URL(o(302),o.b).href,this.shadowRoot.append(e);const t=new URL(o(899),o.b).href;this._audio=new Audio(this.getAttribute("sound-src")||t),this._audio.preload="auto"}attributeChangedCallback(e,t,o){"sound-src"===e&&this._audio&&(this._audio.src=o||"./snap.mp3")}connectedCallback(){this.shadowRoot.innerHTML='\n      <div class="row">\n        <video id="video" playsinline></video>\n        <canvas id="canvas" width="320" height="240"></canvas>\n        <img id="preview" class="preview" alt="Snapshot preview" style="display:none"/>\n      </div>\n\n      <div class="row controls">\n        <button id="start">Start Camera</button>\n        <button id="capture" class="secondary" disabled>Take Photo</button>\n        <button id="retake" class="ghost" disabled>Retake</button>\n        <button id="use" class="secondary" disabled>Use Photo</button>\n\n        <input id="file" type="file" accept="image/*" capture="user">\n        <label class="file-btn" for="file">Upload instead</label>\n      </div>\n\n      <div class="note">All photos stay on this device unless you submit the form.</div>\n      <div id="err" class="error" role="alert" style="display:none"></div>\n    ',this._els={video:this.shadowRoot.getElementById("video"),canvas:this.shadowRoot.getElementById("canvas"),preview:this.shadowRoot.getElementById("preview"),start:this.shadowRoot.getElementById("start"),capture:this.shadowRoot.getElementById("capture"),retake:this.shadowRoot.getElementById("retake"),use:this.shadowRoot.getElementById("use"),file:this.shadowRoot.getElementById("file"),err:this.shadowRoot.getElementById("err")},this._els.start.addEventListener("click",()=>this._startCamera()),this._els.capture.addEventListener("click",()=>this._capture()),this._els.retake.addEventListener("click",()=>this._retake()),this._els.use.addEventListener("click",()=>this._emitPhoto()),this._els.file.addEventListener("change",e=>this._fromFile(e))}disconnectedCallback(){this._stopCamera()}_toggleButtons({start:e,capture:t,retake:o,use:n}){null!=e&&(this._els.start.disabled=!e),null!=t&&(this._els.capture.disabled=!t),null!=o&&(this._els.retake.disabled=!o),null!=n&&(this._els.use.disabled=!n)}_showError(e){this._els.err.textContent=e,this._els.err.style.display="block"}_hideError(){this._els.err.style.display="none"}async _startCamera(){try{if(this._hideError(),this._stopCamera(),!navigator.mediaDevices?.getUserMedia)return this._showError("Camera API not available. Use the Upload button instead."),void this._toggleButtons({start:!0,capture:!1,retake:!1,use:!1});const e={video:{facingMode:"user",width:320,height:240},audio:!1};this._stream=await navigator.mediaDevices.getUserMedia(e);const t=this._els.video;t.srcObject=this._stream,await t.play().catch(()=>{}),t.videoWidth&&t.videoHeight||await new Promise(e=>t.addEventListener("loadedmetadata",e,{once:!0})),this._els.preview.style.display="none",t.style.display="block",this._els.canvas.style.display="none",this._toggleButtons({start:!1,capture:!0,retake:!1,use:!1})}catch(e){console.error("getUserMedia failed:",e),this._showError("Camera blocked or unavailable. You can upload a photo instead."),this._toggleButtons({start:!0,capture:!1,retake:!1,use:!1})}}_stopCamera(){this._stream&&(this._stream.getTracks().forEach(e=>e.stop()),this._stream=null)}_capture(){const e=this._els.video;if(!this._stream||!e||!e.videoWidth)return void this._showError("Camera not ready yet. Click Start, grant permission, then try again.");this._audio&&(this._audio.currentTime=0,this._audio.play().catch(()=>{}));const t=this._els.canvas,o=t.getContext("2d");t.width=e.videoWidth||320,t.height=e.videoHeight||240;try{o.drawImage(e,0,0,t.width,t.height)}catch(e){return console.error("drawImage failed:",e),void this._showError("Could not capture the frame.")}this._els.preview.src=t.toDataURL("image/jpeg",.92),this._els.preview.style.display="block",e.style.display="none",t.style.display="none",this._toggleButtons({start:!1,capture:!1,retake:!0,use:!0})}_retake(){this._els.preview.style.display="none",this._stream?(this._els.video.style.display="block",this._toggleButtons({start:!1,capture:!0,retake:!1,use:!1})):this._toggleButtons({start:!0,capture:!1,retake:!1,use:!1})}_emitPhoto(){const e=this._els.preview.src;e&&this.dispatchEvent(new CustomEvent("photo-taken",{bubbles:!0,composed:!0,detail:{dataUrl:e}}))}_fromFile(e){const t=e.target.files?.[0];if(!t)return;if(!t.type.startsWith("image/"))return void this._showError("Please choose an image file.");const o=new FileReader;o.onload=()=>{this._els.preview.src=o.result,this._els.preview.style.display="block",this._els.video.style.display="none",this._toggleButtons({start:!1,capture:!1,retake:!0,use:!0})},o.readAsDataURL(t)}}customElements.define("zoo-photo-booth",n)},718:(e,t,o)=>{"use strict";o.d(t,{Y:()=>s,notifyAnimalStatusChange:()=>i});let n=[];console.log("Number of Elephants:",4),console.log("Number of Tigers:",2),console.log("Number of Pandas:",3),console.log("Total number of animals in the zoo:",9),n.push({id:1,name:"Ellie",species:"Elephant",count:3,gender:"Female",status:"Open",health:"Healthy"}),n.push({id:2,name:"Tony",species:"Tiger",count:2,gender:"Male",status:"Closed",health:"Sick"}),n.push({id:3,name:"Panda",species:"Panda",count:4,gender:"Male",status:"Open",health:"Healthy"}),n.push({id:4,name:"Leo",species:"Lion",count:5,gender:"Male",status:"Open",health:"Healthy"}),console.log("Current Zoo Animals:"),console.table(n);const s=e=>{try{const t=document.getElementById("animal");if(!t)throw new Error("Animal dropdown not found. Check your HTML.");for(console.log("Populating animal dropdown...");t.firstChild;)t.removeChild(t.firstChild);const o=document.createElement("option");o.value="",o.textContent="-- Select an Animal --",t.appendChild(o),0===e.length?console.warn("No animals found. Dropdown will be empty."):(e.forEach(e=>{const o=document.createElement("option");o.value=e.name,o.textContent=`${e.name} (${e.species})`,t.appendChild(o)}),console.log("Dropdown populated successfully."))}catch(e){console.error("Error populating animal dropdown:",e.message)}};function i(e){"granted"===Notification.permission&&new Notification(`Status Update: ${e.name}`,{body:`${e.name} the ${e.species} is now ${e.status}`,icon:"icons/icon-192.png"})}},867:()=>{class e extends HTMLElement{static get observedAttributes(){return["selector"]}constructor(){super(),this.attachShadow({mode:"open"}),this._activeEl=null,this.shadowRoot.innerHTML='\n      <slot></slot>\n      <span part="hl" class="hl" aria-hidden="true"></span>\n    ',this.hl=this.shadowRoot.querySelector(".hl"),this._onEnter=e=>this._setActive(e.currentTarget),this._onFocus=e=>this._setActive(e.currentTarget),this._onLeave=()=>this._clearActive(),this._reposition=()=>this._activeEl&&this._positionTo(this._activeEl)}get selector(){return this.getAttribute("selector")||"a"}connectedCallback(){this._bind()}disconnectedCallback(){this._unbind()}attributeChangedCallback(){this._unbind(),this._bind()}_bind(){this.links=this.querySelectorAll(this.selector),this.links.forEach(e=>{e.addEventListener("mouseenter",this._onEnter),e.addEventListener("mouseleave",this._onLeave),e.addEventListener("focus",this._onFocus),e.addEventListener("blur",this._onLeave)}),window.addEventListener("scroll",this._reposition,{passive:!0}),window.addEventListener("resize",this._reposition)}_unbind(){this.links&&this.links.forEach(e=>{e.removeEventListener("mouseenter",this._onEnter),e.removeEventListener("mouseleave",this._onLeave),e.removeEventListener("focus",this._onFocus),e.removeEventListener("blur",this._onLeave)}),window.removeEventListener("scroll",this._reposition),window.removeEventListener("resize",this._reposition)}_setActive(e){this._activeEl=e,this._positionTo(e),this.hl.style.opacity="1"}_clearActive(){this._activeEl=null,this.hl.style.opacity="0"}_positionTo(e){const t=e.getBoundingClientRect(),o=this.getBoundingClientRect(),n=t.left+window.scrollX-(o.left+window.scrollX),s=t.top+window.scrollY-(o.top+window.scrollY);this.hl.style.width=`${t.width}px`,this.hl.style.height=`${t.height}px`,this.hl.style.transform=`translate(${n}px, ${s}px)`}}customElements.define("z-hover-highlight",e)},899:(e,t,o)=>{"use strict";e.exports=o.p+"9f00809aa703922b753e.mp3"}},t={};function o(n){var s=t[n];if(void 0!==s)return s.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,o),i.exports}o.m=e,o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var s=n.length-1;s>-1&&(!e||!/^http(s?):/.test(e));)e=n[s--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e+"../../"})(),o.b="undefined"!=typeof document&&document.baseURI||self.location.href,(()=>{"use strict";function e(e){try{const t=document.getElementById("errorContainer");if(!t)return void console.error("Error container not found in the DOM.");for(;t.firstChild;)t.removeChild(t.firstChild);if(Array.from(t.children).map(e=>e.textContent).includes(`${e}`))return;const o=document.createElement("p");o.textContent=`${e}`,t.appendChild(o)}catch(e){console.error("Error displaying error message:",e.message)}}function t(e){try{const t=document.getElementById("successContainer");if(!t)return void console.error("Success container not found in the DOM.");for(;t.firstChild;)t.removeChild(t.firstChild);const o=document.createElement("p");o.style.color="blue",o.textContent=`${e}`,t.appendChild(o)}catch(e){console.error("Error displaying success message:",e.message)}}const n=e=>e.replace(/[^\d]/g,""),s=e=>{const t=n(e);let o=t;if(11===t.length&&t.startsWith("1"))o=t.slice(1);else if(10!==t.length)return!1;const s=o.slice(0,3),i=o.slice(3,6);return!/^[01]/.test(s)&&!/^[01]/.test(i)&&!/^([0-9])\1+$/.test(o)&&"1234567890"!==o&&"1234567891"!==o},i=e=>{const t=n(e),o=11===t.length?t.slice(1):t;return 10!==o.length?e:`(${o.slice(0,3)}) ${o.slice(3,6)}-${o.slice(6)}`},a=(e,t,o=!1)=>{const n=e.closest(".field")?.querySelector(".msg");n&&(n.textContent=t),e.classList.toggle("is-valid",o),e.classList.toggle("is-invalid",!o)},r=e=>{if(console.log("Before Sanitization:",e),e.length>255&&(console.warn("Input truncated due to length limit"),e=e.slice(0,255)),/\b(SELECT|INSERT|DELETE|DROP|UPDATE|UNION|--|;|\|)/gi.test(e))throw console.warn("SQL Injection pattern detected in input:",e),new Error("Suspicious input detected. Please remove any SQL keywords.");const t=e.replace(/<[^>]*>?/gm,"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");return console.log("After Sanitization:",t),t},l=()=>{const e=crypto.randomUUID();sessionStorage.setItem("csrfToken",e);const t=document.getElementById("csrfToken");t&&(t.value=e)},d=()=>JSON.parse(sessionStorage.getItem("submissionTimes")||"[]"),c=()=>{const t=document.getElementById("membershipForm");t&&t.addEventListener("submit",t=>{t.preventDefault();const o=[],n=document.getElementById("csrfToken").value;return(e=>e===sessionStorage.getItem("csrfToken"))(n)?d().filter(e=>Date.now()-e<6e4).length>=5?(console.error("Too many requests. Please wait."),o.push({Test:"Rate Limiting",Input:d(),Expected:"<5",Actual:">=5",Status:"FAIL"}),void console.table(o)):((()=>{const e=Date.now(),t=d().filter(t=>e-t<6e4);t.push(e),sessionStorage.setItem("submissionTimes",JSON.stringify(t))})(),o.push({Test:"Valid Submission",Input:n,Expected:"Success",Actual:"Success",Status:"PASS"}),console.table(o),(t=>{t.preventDefault();try{const o=document.getElementById("name"),n=document.getElementById("email"),l=document.getElementById("membershipType"),d=document.getElementById("startDate"),c=document.getElementById("emergencyContact");if(!(o&&n&&l&&d&&c))throw new Error("Some membership form fields were not found in the DOM.");const u=r(o.value.trim()),h=r(n.value.trim()),m=r(l.value),g=r(d.value),p=r(c.value.trim()),w=document.getElementById("emergencyContact");if(!s(p))return a(w,"Please enter a valid phone number (US, 10 digits)."),void(window.displayError&&e("Invalid emergency contact phone."));a(w,`Phone looks good: ${i(p)}`,!0);const v=(document.getElementById("memberPhotoDataUrl")?.value||"").trim();if(!(u&&h&&m&&g&&p))throw new Error("Please fill in all required fields.");const y=JSON.parse(localStorage.getItem("members"))||[];y.push({name:u,email:h,membershipType:m,startDate:g,emergencyContact:p,photoDataUrl:v}),localStorage.setItem("members",JSON.stringify(y)),window.displaySuccess&&window.displaySuccess("Membership registration successful!"),console.log("Membership registered successfully."),window.updateVisitorCount&&window.updateVisitorCount(1),t.target.reset();const f=document.getElementById("memberPhotoPreview");f&&(f.src="",f.style.display="none");const b=document.getElementById("memberPhotoDataUrl");b&&(b.value="")}catch(e){console.error("Error processing membership registration:",e.message),window.displayError&&window.displayError(e.message)}})(t),void l()):(console.error("Invalid or missing CSRF token."),o.push({Test:"CSRF Token",Input:n,Expected:"Valid",Actual:"Invalid",Status:"FAIL"}),void console.table(o))})};var u=o(718);const h=window.location.origin;function m(e){return new Promise(t=>setTimeout(t,e))}const g=(e,t)=>{try{const o=document.getElementById(e);if(!o)throw new Error(`Element with ID "${e}" not found.`);o.textContent=t}catch(e){console.warn(e.message)}},p=(e,t)=>{try{const o=t.find(t=>t.id===e);if(!o)throw new Error(`Animal with ID ${e} not found.`);return o.status="Open"===o.status?"Closed":"Open",g(`status-${e}`,o.status),console.log(`Animal ID ${e} status toggled to: ${o.status}`),t}catch(e){return console.error("Error toggling animal status:",e.message),t}},w=(e,t)=>{try{const o=t.find(t=>t.id===e);if(!o)throw new Error(`Animal with ID ${e} not found.`);return o.health="Healthy"===o.health?"Sick":"Healthy",g(`health-${e}`,o.health),console.log(`Animal ID ${e} health toggled to: ${o.health}`),t}catch(e){return console.error("Error updating animal health:",e.message),t}},v=[{name:"Elephant Habitat",lat:44.976,lng:-93.265},{name:"Tiger Den",lat:44.977,lng:-93.262}],y=[{id:"E1",name:"First Aid",lat:44.975,lng:-93.261}];class f extends HTMLElement{static get observedAttributes(){return["animal"]}constructor(){super(),this.attachShadow({mode:"open"})}get data(){const e=this.getAttribute("animal");return e?JSON.parse(e):null}set data(e){this.setAttribute("animal",JSON.stringify(e))}connectedCallback(){this.render()}attributeChangedCallback(){this.render()}disconnectedCallback(){}_getLatestAnimal(){const e=this.data;return e?(Array.isArray(window.animals)?window.animals:[]).find(t=>String(t.id)===String(e.id))||e:null}render(){const e=this._getLatestAnimal();if(!e)return void(this.shadowRoot.innerHTML="<em>No animal provided</em>");const t=e.image||"images/default.png",o=t.startsWith("/")?t:`/${t}`;this.shadowRoot.innerHTML=`\n        <style>\n        :host{display:block}\n        .card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:12px;margin:8px 0}\n        h3{margin:.25rem 0 8px;font:600 16px/1.3 system-ui}\n        img{display:block;width:220px;height:auto;border-radius:10px;margin:8px 0}\n        .row{margin:.25rem 0}\n        button{margin-right:8px;border:0;padding:.5rem .8rem;border-radius:8px;cursor:pointer;background:#10b981;color:#fff}\n        button.secondary{background:#3b82f6}\n      </style>\n\n      <article class="card">\n        <h3>${e.name} <small>(${e.species})</small></h3>\n        <img src="${o}" alt="${e.name}" onerror="this.src='/images/default.png'">\n\n        <div class="row">Status: <b id="status-${e.id}">${e.status}</b></div>\n        <div class="row">Health: <b id="health-${e.id}">${e.health}</b></div>\n\n        <div class="row">\n          <button id="toggleStatus">Toggle Status</button>\n          <button id="toggleHealth" class="secondary">Toggle Health</button>\n        </div>\n      </article>\n    `;const n=this.shadowRoot.getElementById("toggleStatus"),s=this.shadowRoot.getElementById("toggleHealth");n.onclick=()=>{p(e.id,window.animals||[]);const t=this._getLatestAnimal(),o=this.shadowRoot.getElementById(`status-${e.id}`);o&&t&&(o.textContent=t.status),this.data=t||e,this.dispatchEvent(new CustomEvent("animal-updated",{bubbles:!0,detail:{id:e.id,status:t?.status}}))},s.onclick=()=>{w(e.id,window.animals||[]);const t=this._getLatestAnimal(),o=this.shadowRoot.getElementById(`health-${e.id}`);o&&t&&(o.textContent=t.health),this.data=t||e,this.dispatchEvent(new CustomEvent("animal-updated",{bubbles:!0,detail:{id:e.id,health:t?.health}}))};const i=this.shadowRoot.querySelector(".wrapper a");if(i){const e=()=>{this._active=!0,this._reposition()},t=()=>{this._active=!1;const e=this.shadowRoot.querySelector(".highlight");e&&(e.style.opacity="0")};i.addEventListener("mouseenter",e),i.addEventListener("focus",e),i.addEventListener("mouseleave",t),i.addEventListener("blur",t),window.addEventListener("scroll",this._reposition,{passive:!0}),window.addEventListener("resize",this._reposition)}}}customElements.define("zoo-animal-card",f),o(867),o(543);const b=()=>{const e=document.getElementById("animalContainer");e.innerHTML="",window.animals.forEach(t=>{const o=document.createElement("zoo-animal-card");o.data=t,e.appendChild(o)})};document.addEventListener("DOMContentLoaded",async()=>{console.log("âœ… Zoo Management System Loaded");const n=document.getElementById("zooStatus");n&&(n.textContent="Zoo Status: Warming upâ€¦");try{(()=>{const e=document.createElement("span");e.className="hover-pill",document.body.appendChild(e);let t=null;const o=t=>{const o=t.getBoundingClientRect();e.style.width=`${o.width}px`,e.style.height=`${o.height}px`,e.style.transform=`translate(${o.left+window.scrollX}px, ${o.top+window.scrollY-4}px)`,e.style.opacity="1"},n=e=>{t=e.currentTarget,o(t)},s=()=>{t=null,e.style.opacity="0"},i=()=>{t&&o(t)};[document.getElementById("zooStatus"),document.getElementById("visitorCounter")].forEach(e=>{e&&(e.hasAttribute("tabindex")||e.setAttribute("tabindex","0"),e.addEventListener("mouseenter",n),e.addEventListener("mouseleave",s),e.addEventListener("focus",n),e.addEventListener("blur",s))}),window.addEventListener("scroll",i,{passive:!0}),window.addEventListener("resize",i)})(),await async function(){const e=await fetch("/ping");if(!e.ok)throw new Error(`HTTP ${e.status}`);return e.json()}();const d=await async function(){return(await async function(e,{retries:t=5,backoff:o=800,timeout:n=12e3,init:s={}}={}){for(let i=0;i<=t;i++){const a=new AbortController,r=setTimeout(()=>a.abort(),n);try{const t=await fetch(`${h}${e}`,{cache:"no-store",signal:a.signal,...s});if(clearTimeout(r),[502,503,504].includes(t.status))throw new Error(`Transient ${t.status}`);if(!t.ok)throw new Error(`HTTP ${t.status}`);return t}catch(e){if(clearTimeout(r),i===t)throw e;await m(o*Math.pow(2,i))}}}("/api/animals",{retries:4,backoff:700})).json()}();if(window.animals=d,(0,u.Y)(d),b(),f(window.animals.map(e=>[e.name??"",e.species??"",e.status??"",e.health??""])),n&&(n.textContent="Zoo Status: Open"),!(()=>{if("localhost"===location.hostname||"127.0.0.1"===location.hostname||"[::1]"===location.hostname)return console.log("Skipping HTTPS enforcement on localhost/dev."),!0;if("https:"!==location.protocol){console.warn("Security Warning: Insecure protocol detected. Redirecting to HTTPSâ€¦");const e=document.getElementById("errorContainer");e&&(e.textContent="This site requires a secure HTTPS connection. Redirecting to secure version...");const t=location.href.replace(/^http:/i,"https:");return location.replace(t),!1}return console.log("HTTPS protocol verified. Secure connection is active."),!0})())return;function f(e){const t=document.querySelector("#animalTable tbody");t.innerHTML="",e.forEach(e=>{const o=document.createElement("tr");e.forEach(e=>{const t=document.createElement("td");t.textContent=e,o.appendChild(t)}),t.appendChild(o)})}["membershipForm","bookingForm"].forEach(e=>{const t=document.getElementById(e);if(t&&!t.querySelector("#csrfToken")){const e=document.createElement("input");e.type="hidden",e.id="csrfToken",e.name="csrfToken",t.appendChild(e)}}),l(),c(),(()=>{console.log("Initializing membership form...");const e=document.getElementById("membershipForm");e?e.reset():console.error("Membership form not found.")})(),function(o){const n=document.getElementById("addAnimalForm");if(!n)return void console.warn("addAnimalForm not found");const s=e=>n.querySelector("#"+e),i=(e,t,o=!1)=>{const n=e.closest(".field")?.querySelector(".msg");n&&(n.textContent=t||"",n.style.color=o?"green":"red")},a=/^[A-Za-z ]{3,}$/,r=/^[A-Za-z ]+$/,l=/^(Open|Closed)$/i,d=/^(Healthy|Sick|Injured)$/i,c=/^images\/.+\.(png|jpe?g|gif|webp)$/i;n.addEventListener("submit",u=>{u.preventDefault();const h=s("animalName"),m=s("animalSpecies"),g=s("animalStatus"),p=s("animalHealth"),w=s("animalImage"),v=s("animalLat"),y=s("animalLng");[h,m,g,p,w,v,y].forEach(e=>i(e,""));let f=!0;a.test(h.value.trim())||(f=!1,i(h,"Name must be 3+ letters/spaces.")),r.test(m.value.trim())||(f=!1,i(m,"Species must be letters only.")),l.test(g.value.trim())||(f=!1,i(g,'Status must be "Open" or "Closed".')),d.test(p.value.trim())||(f=!1,i(p,"Health must be Healthy, Sick, or Injured.")),c.test(w.value.trim())||(f=!1,i(w,'Image must look like "images/ellie.png".'));const b=Number(v.value),E=Number(y.value);if((!Number.isFinite(b)||Math.abs(b)>90)&&(f=!1,i(v,"Latitude must be a number between -90 and 90.")),(!Number.isFinite(E)||Math.abs(E)>180)&&(f=!1,i(y,"Longitude must be a number between -180 and 180.")),!f)return void e("Please fix the highlighted fields and try again.");const S={id:Date.now(),name:h.value.trim(),species:m.value.trim(),status:/open/i.test(g.value)?"Open":"Closed",health:p.value.trim(),location:{lat:b,lng:E},feedingSchedule:[],maintenanceRecords:[],image:w.value.trim()};console.log("Submitting NEW ANIMAL â†’",S);try{o(S),n.reset(),t(`Added ${S.name} (${S.species}) to the zoo.`)}catch(t){console.error("Unable to add animal:",t),e("Something went wrong while adding the animal.")}})}(e=>{window.animals.push(e),b(),(0,u.Y)(window.animals),t(`âœ… ${e.name} added successfully!`)}),(()=>{const e=document.getElementById("bookingForm");e?e.addEventListener("submit",t=>{t.preventDefault();try{const t=r(document.getElementById("visitorName").value.trim()),o=r(document.getElementById("contact").value.trim()),n=document.getElementById("contact");if(!s(o))return a(n,"Invalid phone number. Must be 10 digits."),void alert("Please enter a valid phone number.");a(n,"Phone looks good!",!0),n.value=i(o);const l=r(document.getElementById("animal").value),d=r(document.getElementById("dateTime").value),c=parseInt(document.getElementById("groupSize").value,10);if(!t||!o||!l||!d||isNaN(c)||c<1)throw new Error("Please fill in all required fields with valid data.");const u=JSON.parse(localStorage.getItem("bookings"))||[];u.push({visitorName:t,contact:o,selectedAnimal:l,dateTime:d,groupSize:c}),localStorage.setItem("bookings",JSON.stringify(u)),alert("Booking confirmed!"),window.updateVisitorCount&&window.updateVisitorCount(c),e.reset()}catch(e){console.error("Error processing booking:",e.message),alert(e.message)}}):console.error("Booking form not found. Check your HTML.")})(),(async()=>{try{console.log("Admin Dashboard: Updating real-time data...")}catch(e){console.error("Error updating admin dashboard:",e.message)}})(),window.toggleZooStatus=()=>{const e=document.getElementById("zooStatus"),t=e.textContent.includes("Open"),o=t?"Closed":"Open",n=((e,t)=>{try{const o="Open"===e?"Closed":"Open",n=document.getElementById("zooStatus");return n&&(n.textContent=`Zoo Status: ${o}`),t.forEach(e=>{e.status=o}),t.forEach(({id:e})=>{const t=document.getElementById(`status-${e}`);t&&(t.textContent=o)}),document.querySelectorAll("zoo-animal-card").forEach(e=>{const n=e.data?.id;if(null==n)return;const s=e.shadowRoot?.getElementById(`status-${n}`);s&&(s.textContent=o);const i=t.find(e=>String(e.id)===String(n));i&&(e.data=i)}),console.log(`Zoo status changed to: ${o}`),{zooStatus:o,animals:t}}catch(o){return console.error("Error toggling zoo status:",o.message),{zooStatus:e,animals:t}}})(t?"Open":"Closed",window.animals);n&&n.animals?(window.animals=n.animals,e.textContent=`Zoo Status: ${n.zooStatus}`):(window.animals.forEach(e=>{e.status=o}),e.textContent=`Zoo Status: ${o}`),document.querySelectorAll("zoo-animal-card").forEach(e=>{const t=e.data?.id,o=window.animals.find(e=>String(e.id)===String(t));if(!o)return;const n=e.shadowRoot?.getElementById(`status-${t}`);n&&(n.textContent=o.status),e.data=o})},window.updateHealth=e=>{w(e,window.animals)},window.displayZooStatistics=()=>{(e=>{try{const t=e.length,o=e.filter(e=>"Open"===e.status).length,n=e.filter(e=>"Closed"===e.status).length,s=localStorage.getItem("visitorCount")||0;console.log("Zoo Statistics:"),console.table([{"Total Animals":t},{"Open Animals":o},{"Closed Animals":n},{"Visitor Count":s}]),alert(`Zoo Statistics:\nTotal: ${t}\nOpen: ${o}\nClosed: ${n}\nVisitors: ${s}`)}catch(e){console.error("Error displaying zoo statistics:",e.message)}})(window.animals)},window.updateVisitorCount=e=>{(e=>{try{let t=parseInt(localStorage.getItem("visitorCount"))||0;t+=e,t<0&&(t=0),localStorage.setItem("visitorCount",t),g("visitorCounter",`Visitors: ${t}`),console.log(`Visitor count updated: ${t}`)}catch(e){throw console.error("Error updating visitor count:",e.message),e}})(e)},window.toggleStatus=e=>{p(e,window.animals);const t=window.animals.find(t=>t.id===e);t&&Promise.resolve().then(o.bind(o,718)).then(({notifyAnimalStatusChange:e})=>{e(t)})},window.displayError=e,window.displaySuccess=t,console.group("ðŸ“ Geolocation Data"),console.table(v),console.table(y),console.groupEnd(),"serviceWorker"in navigator&&!/^(localhost|127\.0\.0\.1)/.test(location.hostname)&&navigator.serviceWorker.register("/serviceworker.js").then(()=>console.log("Service Worker registered")).catch(e=>console.error("SW registration failed",e)),function(){const e=document.getElementById("memberCamera"),t=document.getElementById("memberPhotoDataUrl"),o=document.getElementById("memberPhotoPreview");e&&t&&e.addEventListener("photo-taken",e=>{const{dataUrl:n}=e.detail||{};t.value=n||"",o&&(o.src=n||"",o.style.display=n?"block":"none")})}()}catch(E){console.error("Critical Error: Unable to initialize Zoo Management System.",E),e("A serious error occurred. Please reload the page."),n&&(n.textContent="Zoo Status: Error (try refresh)")}}),"Notification"in window&&"granted"!==Notification.permission&&Notification.requestPermission().then(e=>{"granted"===e&&console.log("ðŸŸ¢ Notification permission granted")})})()})();
//# sourceMappingURL=main.396bf7e0044f8a748593.js.map